## 准备工作

需要用的工具以及项目：

   * 小游戏插件快速启动模版：当前项目
   * 最新版本微信开发者工具：[传送门](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
   * 注册一个微信公众平台账号，获取 AppID（需要上传引擎插件与使用引擎插件时使用）

## 打开插件项目

* 打开微信开发者工具，选择【小游戏】选项中导入【小游戏插件快速启动模版】

小游戏插件快速启动模版包括：

1. `minigame` 目录：普通的小游戏项目，用户编写小游戏插件的使用 Demo，上传插件代码时这个 Demo 会一起上传，作为小游戏插件的发布审核依据。
2. `plugin` 目录：是小游戏插件代码目录(**小游戏插件必须单独目录**)。
3.  `doc` 目录：用于放置插件开发文档
4. `project.config.json` ：为配置文件，`compileType === 'gamePlugin'`时才可正常使用插件项目。详情可参考[《项目配置文件》](https://developers.weixin.qq.com/miniprogram/dev/devtools/projectconfig.html)

插件目录结构：
```
plugin
 ├── cocos2d-js-min.js   // 引擎插件，名称需要与 plugin.json 配置中的 "main" 字段一致
 └── plugin.json         // 插件配置文件
```

插件配置文件：
```
插件的配置文件 `plugin.json` 中必须包含**插件的入口 js 文件**。具体格式如下：
{
  "main": "cocos2d-js-min.js"
}
```

## 进行插件开发测试

开发小游戏插件时，必须将工具栏上的编译模式调整为 “小游戏插件模式”。

通过设置 `game.json` 配置文件中的 `plugins` 里 `version` 字段来进行线上或者本地引擎插件版本的测试。

`version: dev`   - 微信开发者工具会将 `project.config.json` 中 `pluginRoot` 指定的文件夹设置为插件文件夹。
`version: 2.1.3` - 微信开发者工具将工具使用线上的插件。


## 预览、上传和发布

#### 预览：

插件可以像小游戏一样预览和上传，但插件没有体验版。
插件会同时有多个线上版本，由使用插件的小程序决定具体使用的版本号。
手机预览和提审插件时，会使用一个特殊的小程序来套用项目中 minigame 文件夹下的小程序，从而预览插件。

#### 上传：

通过点击微信开发者工具栏上的上传按钮 ![](https://user-images.githubusercontent.com/7564028/67272449-25cc0700-f4ef-11e9-904e-24ce98ac5706.png) 并填写弹出窗口中的信息后即可上传。

 ![](https://user-images.githubusercontent.com/7564028/67272563-5f9d0d80-f4ef-11e9-9e92-b60bebc4e77a.png) 

**注意：这里的版本号每次上传只能大于上一个版本号（例如：线上版本号为 2.1.3，上传的版本号必须是 2.1.4 或者是 2.1.3 以上的版本号）。如果上传错误以后是不可修改的，所以需要谨慎**

上传插件后，插件不会立刻发布。此时可以使用帐号和密码登录 [管理后台](https://mp.weixin.qq.com/)，选择左边列表中【功能】>【小程序插件】打开小程序插件页面选择开发管理。

开发管理有三个板块：

1. 线上版本 -- 当前你发布的线上版本
2. 审核版本 -- 开发版本通过审核后到版本，需要点击发布才能发布到线上
3. 开发版本 -- 上传插件后需要点击提交审核进入到审核版本

# 插件开发文档

在第三方小程序使用插件时，插件代码并不可见。因此，除插件代码外，我们还支持插件开发者上传一份插件开发文档。这份开发文档将展示在插件详情页，供其他开发者在浏览插件和使用插件时进行阅读和参考。
插件开发者应在插件开发文档中对插件所提供的功能进行必要的描述和解释，方便第三方小程序正确使用插件。

插件文档必须放置在项目根目录的 `doc` 目录下，目录结构如下：

```
doc
├── README.md   // 插件文档，必须为 markdown 格式
└── picture.jpg // 其他资源文件，仅支持图片
```

其中，`README.md` 的编写有一定的限制条件，包括：

- 引用到的图片资源不能是网络图片，且必须放在 `doc` 目录下；
- 文档中的链接只能链接到：
  - 微信开发者社区（developers.weixin.qq.com）
  - 微信公众平台（mp.weixin.qq.com）
  - GitHub（github.com）
- 编辑 README.md 之后，可以使用开发者工具打开 README.md，并在编辑器的右下角【预览】和【上传】按钮进行预览或者上传文档。注意，如在微信开发者工具中编辑文档，上传前需手动保存一次。上传时版本号可任意填写。上传文档后，文档不会立刻发布。此时需要使用帐号和密码登录 [管理后台](https://mp.weixin.qq.com/)，在 小程序插件 > 基本设置 中预览、发布文档。
